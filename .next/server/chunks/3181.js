exports.id=3181,exports.ids=[3181],exports.modules={51895:(e,a,t)=>{let r={"0032af294b820d5b2f6ecb599810073224fb8405":()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.getCardTest),"2c8f731e7c04d6b71f833304321e741fa16aeefd":()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.saveCard),"32a3617889b58b88de5846c96efc11d8a1322d4a":()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.saveTag),"40b0e9a5fae5e29abe9213bb007d11cec6f7e31f":()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.getCard),"479742cc8645e1909d54f38cd9fe015e9621ab60":()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.removeCard),"50b8ee2c01702d556b77028eb169eaff9ea0f820":()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.getCardsOfMy),"523b5dd287e6725b6f91274aca1051653bfdf0e6":()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.removeTag),"59141756fe4b901c2b6407bb9725bab62d2967e1":()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.createTag),"651d629a9efc5ac1f2e83ecc837477b8129dac19":()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.getTagAll),"6d2e69b109044da9a0608b4844be959036b9b175":()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.setCardFamiliarity),"92a63b1efc916ff008d1272dc5a65580af78af67":()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.getCardsOfOthers),ae2756021412af3c7533170046625d9bfe173ca7:()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.saveCardTag),b9098ba02eb30e332c60e216b96eda5868da288a:()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.getTag),df00bf37cbab4bf5a2619198bda3529bfdbcdb95:()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.getCardTestByUUID),e823d41150d545f99bbf87cae1e8e034f9d4827a:()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.saveCardReview),fbde93d90dfb682967795128b2ca856ab81d14aa:()=>Promise.resolve().then(t.bind(t,15316)).then(e=>e.getCardTag)};async function d(e,...a){return(await r[e]()).apply(null,a)}e.exports={"0032af294b820d5b2f6ecb599810073224fb8405":d.bind(null,"0032af294b820d5b2f6ecb599810073224fb8405"),"2c8f731e7c04d6b71f833304321e741fa16aeefd":d.bind(null,"2c8f731e7c04d6b71f833304321e741fa16aeefd"),"32a3617889b58b88de5846c96efc11d8a1322d4a":d.bind(null,"32a3617889b58b88de5846c96efc11d8a1322d4a"),"40b0e9a5fae5e29abe9213bb007d11cec6f7e31f":d.bind(null,"40b0e9a5fae5e29abe9213bb007d11cec6f7e31f"),"479742cc8645e1909d54f38cd9fe015e9621ab60":d.bind(null,"479742cc8645e1909d54f38cd9fe015e9621ab60"),"50b8ee2c01702d556b77028eb169eaff9ea0f820":d.bind(null,"50b8ee2c01702d556b77028eb169eaff9ea0f820"),"523b5dd287e6725b6f91274aca1051653bfdf0e6":d.bind(null,"523b5dd287e6725b6f91274aca1051653bfdf0e6"),"59141756fe4b901c2b6407bb9725bab62d2967e1":d.bind(null,"59141756fe4b901c2b6407bb9725bab62d2967e1"),"651d629a9efc5ac1f2e83ecc837477b8129dac19":d.bind(null,"651d629a9efc5ac1f2e83ecc837477b8129dac19"),"6d2e69b109044da9a0608b4844be959036b9b175":d.bind(null,"6d2e69b109044da9a0608b4844be959036b9b175"),"92a63b1efc916ff008d1272dc5a65580af78af67":d.bind(null,"92a63b1efc916ff008d1272dc5a65580af78af67"),ae2756021412af3c7533170046625d9bfe173ca7:d.bind(null,"ae2756021412af3c7533170046625d9bfe173ca7"),b9098ba02eb30e332c60e216b96eda5868da288a:d.bind(null,"b9098ba02eb30e332c60e216b96eda5868da288a"),df00bf37cbab4bf5a2619198bda3529bfdbcdb95:d.bind(null,"df00bf37cbab4bf5a2619198bda3529bfdbcdb95"),e823d41150d545f99bbf87cae1e8e034f9d4827a:d.bind(null,"e823d41150d545f99bbf87cae1e8e034f9d4827a"),fbde93d90dfb682967795128b2ca856ab81d14aa:d.bind(null,"fbde93d90dfb682967795128b2ca856ab81d14aa")}},53134:(e,a,t)=>{"use strict";t.d(a,{CZ:()=>u,LG:()=>b,gY:()=>i,ln:()=>o,lq:()=>c,pl:()=>d,tc:()=>f,yJ:()=>n,z_:()=>s}),t(15424);var r=t(46242),d=(0,r.$)("ae2756021412af3c7533170046625d9bfe173ca7");(0,r.$)("50b8ee2c01702d556b77028eb169eaff9ea0f820"),(0,r.$)("92a63b1efc916ff008d1272dc5a65580af78af67"),(0,r.$)("40b0e9a5fae5e29abe9213bb007d11cec6f7e31f");var s=(0,r.$)("2c8f731e7c04d6b71f833304321e741fa16aeefd"),n=(0,r.$)("479742cc8645e1909d54f38cd9fe015e9621ab60");(0,r.$)("df00bf37cbab4bf5a2619198bda3529bfdbcdb95"),(0,r.$)("0032af294b820d5b2f6ecb599810073224fb8405");var i=(0,r.$)("e823d41150d545f99bbf87cae1e8e034f9d4827a"),c=(0,r.$)("6d2e69b109044da9a0608b4844be959036b9b175");(0,r.$)("b9098ba02eb30e332c60e216b96eda5868da288a");var u=(0,r.$)("651d629a9efc5ac1f2e83ecc837477b8129dac19"),b=(0,r.$)("32a3617889b58b88de5846c96efc11d8a1322d4a"),o=(0,r.$)("59141756fe4b901c2b6407bb9725bab62d2967e1"),f=(0,r.$)("523b5dd287e6725b6f91274aca1051653bfdf0e6");(0,r.$)("fbde93d90dfb682967795128b2ca856ab81d14aa")},15316:(e,a,t)=>{"use strict";t.r(a),t.d(a,{createTag:()=>P,getCard:()=>l,getCardTag:()=>C,getCardTest:()=>m,getCardTestByUUID:()=>h,getCardsOfMy:()=>o,getCardsOfOthers:()=>f,getTag:()=>q,getTagAll:()=>v,removeCard:()=>g,removeTag:()=>p,saveCard:()=>_,saveCardReview:()=>w,saveCardTag:()=>j,saveTag:()=>$,setCardFamiliarity:()=>y});var r,d,s=t(24330);t(60166);var n=t(13538),i=t(40644),c=t(53524);!function(e){e.Normal="normal",e.Easy="easy",e.Unspecified="unspecified",e.Uncomplete="uncomplete"}(r||(r={}));let u="all tagged",b="not tagged";async function o(e,a,t,d,s,i){let o;let f=c.Prisma.sql`
        select * from qsa_card t0 where t0.user_id = ${e}
    `,l=c.Prisma.sql`
        select count(1) as total from qsa_card t0 where t0.user_id = ${e}
    `,_=c.Prisma.sql`
        -- use this condition only when tag_uuid is a uuid
        -- don't use this condition if tag_uuid = unspecified/all/no (always true)
        and (exists (select 1 from qsa_card_tag t1 where
                t1.card_uuid = t0.uuid
                and t1.tag_uuid = ${t})
            or ${t} = ${"unspecified"}
            or ${t} = ${u}
            or ${t} = ${b})
        -- need no condition if tag_uuid = unspecified
        and 1 = 1
        -- use this condition only when tag_uuid = all
        -- don't use this condition if tag_uuid != all (always true)
        and (exists (select 1 from qsa_card_tag t1 where
                t1.card_uuid = t0.uuid)
            or ${t} != ${u})
        -- use this condition only when tag_uuid = no
        -- don't use this condition if tag_uuid != no
        and (not exists (select 1 from qsa_card_tag t1 where
                t1.card_uuid = t0.uuid)
            or ${t} != ${b})
    `,g=d.replaceAll(/\s+/g," ").replaceAll(/^\s+|\s+$/g,""),h=d?c.Prisma.sql`
            and (lower(t0.question) like lower(${"%"+g+"%"})
                or lower(t0.answer) like lower(${"%"+g+"%"}))
        `:c.Prisma.sql``,m=c.Prisma.sql`
        limit ${i} offset ${(s-1)*i}
    `,w=c.Prisma.sql`
        order by updated_at desc
    `;switch(a){case r.Unspecified:o=c.Prisma.join([_,h]," ");break;case r.Normal:o=c.Prisma.join([c.Prisma.sql`
                    and length(t0.question) > 0
                    and length(t0.answer) > 0
                    and t0.familiarity < 6
                `,_,h]," ");break;case r.Easy:o=c.Prisma.join([c.Prisma.sql`
                    and t0.familiarity = 6
                `,_,h]," ");break;case r.Uncomplete:o=c.Prisma.join([c.Prisma.sql`
                    and (length(t0.question) = 0 or length(t0.answer) = 0)
                `,_,h]," ")}try{let e=c.Prisma.join([f,o,w,m]," "),a=await n._.$queryRaw(e),t=c.Prisma.join([l,o]," "),r=await n._.$queryRaw(t),d=Number(r[0]?.total||0);return{status:"success",data:a,total_records:d,page:s,total_pages:Math.ceil(d/i)}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function f(e,a,t,r){let d=c.Prisma.sql`
        select * from qsa_card t0 where t0.user_id != ${e}
    `,s=c.Prisma.sql`
        select count(1) as total from qsa_card t0 where t0.user_id != ${e}
    `,i=c.Prisma.sql`
        and length(t0.question) > 0
        and length(t0.answer) > 0
    `,u=a?c.Prisma.sql`and t0.user_id = ${a}`:c.Prisma.sql``,b=c.Prisma.sql`
        order by created_at desc
    `,o=c.Prisma.sql`
        limit ${r} offset ${(t-1)*r}
    `;try{let e=c.Prisma.join([d,i,u,b,o]," "),a=await n._.$queryRaw(e),f=c.Prisma.join([s,i,u]," "),l=await n._.$queryRaw(f),_=Number(l[0]?.total||0);return{status:"success",data:a,total_records:_,page:t,total_pages:Math.ceil(_/r)}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function l(e){try{let a=await n._.qsa_card.findUnique({where:{uuid:e}});if(!a)return{status:"error",error:"no data found"};return{status:"success",data:a}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function _(e){if(0===e.question.length||0===e.answer.length)return{status:"error",error:"invalid card"};try{e.uuid&&""!==e.uuid||(e.uuid=(0,i.Fs)());let a=await n._.qsa_card.upsert({where:{uuid:e.uuid},create:e,update:e});return{status:"success",data:a}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function g(e){try{let a=await n._.qsa_card.delete({where:{uuid:e}});return{status:"success",data:a}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function h(e){try{let[a,t]=await Promise.all([n._.qsa_card.findUnique({where:{uuid:e}}),n._.qsa_card_review.findUnique({where:{uuid:e}})]);if(!a)return{status:"error",error:"no data found"};if(t)return{status:"success",data:{...t,card:a}};return{status:"success",data:{uuid:(0,i.Fs)(),card_uuid:a.uuid,user_id:a.user_id,interval_days:0,ease_factor:0,repetitions:0,familiarity:0,last_review_at:new Date,next_review_at:new Date,card:a}}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function m(e,a){try{let t=await n._.$queryRaw(c.Prisma.sql`SELECT t0.*
                    FROM qsa_card_review t0
                    WHERE t0.familiarity < 6
                    and t0.user_id = ${e}
                    and t0.next_review_at < now()
                    and exists (select 1 from qsa_card_tag t1 where
                        t1.card_uuid = t0.card_uuid
                        and t1.tag_uuid = ${a})
                    `);if(t.length>0){let e=t.map(e=>6-e.familiarity),a=t[(0,i.u1)(e)],r=await n._.qsa_card.findUnique({where:{uuid:a.card_uuid}});if(!r)return{status:"error",error:`no card found by uuid: ${a.card_uuid}`};return{status:"success",data:{...a,card:r}}}let r=await n._.$queryRaw(c.Prisma.sql`SELECT t0.* 
                FROM qsa_card t0 
                WHERE length(t0.question) > 0
                and length(t0.answer) > 0
                and t0.familiarity < 6
                and t0.user_id = ${e}
                and exists (select 1 from qsa_card_tag t1 where
                    t1.card_uuid = t0.uuid
                    and t1.tag_uuid = ${a})
                `);if(r.length>0){let e=r.map(e=>6-e.familiarity),a=(0,i.u1)(e);return{status:"success",data:{uuid:(0,i.Fs)(),card_uuid:r[a].uuid,user_id:r[a].user_id,interval_days:0,ease_factor:0,repetitions:0,familiarity:0,last_review_at:new Date,next_review_at:new Date,card:r[a]}}}return{status:"error",error:"no card found for test"}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function w(e){try{return await n._.qsa_card_review.upsert({where:{uuid:e.uuid},create:e,update:e}),await n._.qsa_card.update({where:{uuid:e.uuid},data:{familiarity:e.familiarity}}),!0}catch(e){return console.log(e),!1}}async function y(e,a){try{return await n._.qsa_card.update({where:{uuid:e},data:{familiarity:a}}),!0}catch(e){return console.log(e),!1}}async function q(e){try{let a=await n._.qsa_tag.findUnique({where:{uuid:e}});if(!a)return{status:"error",error:"no data found"};return{status:"success",data:a}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function v(e){try{let a=await n._.qsa_tag.findMany({where:{OR:[{user_id:e},{user_id:"public"}]},orderBy:{tag:"asc"}});return{status:"success",data:a}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function $(e){if(0===e.tag.length)return{status:"error",error:"empty tag content"};try{e.uuid&&""!==e.uuid||(e.uuid=(0,i.Fs)());let a=await n._.qsa_tag.upsert({where:{uuid:e.uuid},create:e,update:e});return{status:"success",data:a}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function P(e){try{let a=await n._.qsa_tag.create({data:e});return{status:"success",data:a}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function p(e){if(e.match(/_by_system$/))return{status:"error",error:"cannot remove tag created by system"};try{let a=await n._.qsa_tag.delete({where:{uuid:e}});return await n._.qsa_card_tag.deleteMany({where:{tag_uuid:e}}),{status:"success",data:a}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function C(e,a){try{let t=await n._.$queryRaw(c.Prisma.sql`select t0.* from qsa_card_tag t0, qsa_tag t1 where
                t0.tag_uuid = t1.uuid
                and t0.card_uuid = ${a}
                and t1.user_id in (${e}, 'public')
                `);if(!t)return{status:"error",error:"no data found"};let r={uuid:a,tag_list_added:t.map(e=>e.tag_uuid)};return{status:"success",data:r}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}async function j(e){if("string"!=typeof e.uuid)return{status:"error",error:"card uuid is empty"};let a=e.uuid;try{return e.tag_list_new&&e.tag_list_new.length>0&&await n._.qsa_card_tag.createMany({data:e.tag_list_new.map(e=>({uuid:(0,i.Fs)(),card_uuid:a,tag_uuid:e,created_at:new Date,updated_at:new Date}))}),e.tag_list_remove&&e.tag_list_remove.length>0&&await n._.qsa_card_tag.deleteMany({where:{card_uuid:a,tag_uuid:{in:e.tag_list_remove}}}),{status:"success",data:{uuid:a}}}catch(e){return console.log(e),{status:"error",error:e.toString()}}}(function(e){e[e.NewlyAdded=0]="NewlyAdded",e[e.StillUnfamiliar=1]="StillUnfamiliar",e[e.PassiveUnderstanding=2]="PassiveUnderstanding",e[e.RecognitionWithoutUnderstanding=3]="RecognitionWithoutUnderstanding",e[e.UnderstandingInContext=4]="UnderstandingInContext",e[e.ActiveRecall=5]="ActiveRecall",e[e.NaturalUsage=6]="NaturalUsage"})(d||(d={})),(0,t(40618).h)([o,f,l,_,g,h,m,w,y,q,v,$,P,p,C,j]),(0,s.j)("50b8ee2c01702d556b77028eb169eaff9ea0f820",o),(0,s.j)("92a63b1efc916ff008d1272dc5a65580af78af67",f),(0,s.j)("40b0e9a5fae5e29abe9213bb007d11cec6f7e31f",l),(0,s.j)("2c8f731e7c04d6b71f833304321e741fa16aeefd",_),(0,s.j)("479742cc8645e1909d54f38cd9fe015e9621ab60",g),(0,s.j)("df00bf37cbab4bf5a2619198bda3529bfdbcdb95",h),(0,s.j)("0032af294b820d5b2f6ecb599810073224fb8405",m),(0,s.j)("e823d41150d545f99bbf87cae1e8e034f9d4827a",w),(0,s.j)("6d2e69b109044da9a0608b4844be959036b9b175",y),(0,s.j)("b9098ba02eb30e332c60e216b96eda5868da288a",q),(0,s.j)("651d629a9efc5ac1f2e83ecc837477b8129dac19",v),(0,s.j)("32a3617889b58b88de5846c96efc11d8a1322d4a",$),(0,s.j)("59141756fe4b901c2b6407bb9725bab62d2967e1",P),(0,s.j)("523b5dd287e6725b6f91274aca1051653bfdf0e6",p),(0,s.j)("fbde93d90dfb682967795128b2ca856ab81d14aa",C),(0,s.j)("ae2756021412af3c7533170046625d9bfe173ca7",j)}};