(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9276],{42806:function(t,e,n){Promise.resolve().then(n.bind(n,50813))},50813:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return b}});var s=n(57437),i=n(2265),l=n(69813),r=n(84459),a=n(76993),c=n(70971),o=n(11956),d=n(52150),h=n(7017),u=n(62753),p=n(20021),m=n(34471),x=n(79601),f=n(16356),_=n(87138);function j(t){let{item:e,index:n,media:a,with_translation:c}=t,[o,d]=(0,i.useState)(""),[h,u]=(0,i.useState)(!1),[j,g]=(0,i.useState)(!1),v=t=>t===e.content()||p.H.pureContent(t)===p.H.pureContent(e.content());return(0,s.jsxs)("div",{className:"flex flex-row items-center justify-start w-full gap-1",children:[(0,s.jsx)(m.e,{content:"turn green on success: punctuation does not matter",children:(0,s.jsx)(x.h,{size:"sm",radius:"sm",name:"".concat(e.position),color:h?"success":"default"})}),(0,s.jsx)(m.e,{content:"shortcut: Ctrl+S, Ctrl+D, or type two spaces at the end",children:(0,s.jsx)(r.A,{isIconOnly:!0,variant:"light",tabIndex:-1,onPress:()=>{a.paused?e.playMedia(a,!1):a.pause()},children:(0,s.jsx)(f.wvg,{size:30})})}),(0,s.jsx)(m.e,{isOpen:j,placement:"top",className:"bg-slate-300",content:(0,s.jsx)("div",{className:"flex flex-col items-start justify-start text-xl px-4 py-2",children:(0,s.jsx)("div",{children:(t=>{let n=p.H.splitContent(t,!0).map(t=>t.content),s=p.H.splitContent(e.content(),!1);for(let t=0;t<s.length;t++)s[t].isWord&&!n.includes(s[t].content)&&(s[t].content=p.H.hideWord(s[t].content));return s.map(t=>t.content).join("")})(o)})}),children:(0,s.jsx)(l.Y,{"aria-label":"input answer",variant:"bordered",id:"d-s-i-".concat(n),classNames:{input:"text-xl font-bold"},value:o,onChange:t=>{let n=t.target.value;n.endsWith("  ")?a.paused?e.playMedia(a,!1):a.pause():(d(n),!h&&v(n)&&u(!0),h&&!v(n)&&u(!1))},onFocus:t=>{g(!0)},onBlur:t=>{g(!1)},onKeyDown:t=>{t.ctrlKey&&"sS".includes(t.key)&&(a.paused?e.playMedia(a,!1):a.pause(),t.preventDefault()),t.ctrlKey&&"dD".includes(t.key)&&(a.paused?e.playMedia(a,!0):a.pause(),t.preventDefault())}})}),c?(0,s.jsx)(m.e,{placement:"top-end",className:"bg-slate-300",content:(0,s.jsx)("div",{className:"flex flex-col items-start justify-start text-xl px-4 py-2",children:(0,s.jsx)("pre",{children:e.translation_list.length>0?e.translation().replaceAll(/\d/g,"x"):"no translation"})}),children:(0,s.jsx)(r.A,{isIconOnly:!0,variant:"light",tabIndex:-1,children:(0,s.jsx)(f.$x8,{size:30})})}):null,(0,s.jsx)(m.e,{placement:"top-end",className:"bg-slate-300",content:(0,s.jsx)("div",{className:"text-xl px-4 py-2",children:e.content()}),children:(0,s.jsx)(r.A,{isIconOnly:!0,variant:"light",tabIndex:-1,children:(0,s.jsx)(f.r$n,{size:30})})}),(0,s.jsx)(m.e,{color:"primary",content:"add card",children:(0,s.jsx)(r.A,{isIconOnly:!0,variant:"light",tabIndex:-1,as:_.default,target:"_blank",href:"/card/add?edit=y&question=".concat(encodeURIComponent(e.content())),children:(0,s.jsx)(f.Yqy,{size:20})})})]})}var g=n(28196);let v=t=>{let{href:e,children:n}=t;return(0,s.jsx)(_.default,{href:e,className:"text-blue-600 underline",target:"_blank",children:n})};function b(){let[t,e]=(0,i.useState)(),[n,m]=(0,i.useState)(),[x,f]=(0,i.useState)(!1),[_,b]=(0,i.useState)(!1),[y,N]=(0,i.useState)(""),[w,S]=(0,i.useState)(""),[A,k]=(0,i.useState)([]),W=(0,i.useRef)(null),I=(0,i.useRef)(null),C=(0,i.useRef)(null),E=(0,i.useRef)(null),z=t=>{S(t);let e=p.H.parse_srt_content(t,x);"success"===e.status?e.data.length>0&&(k(e.data),N("")):N(e.error)},M=t=>()=>{let e=1e3*t.currentTime;for(let t=0;t<A.length;t++)if(e<=A[t].end_ms){let e=document.getElementById("d-s-i-".concat(t));null==e||e.scrollIntoView({behavior:"smooth",block:"center"}),null==e||e.focus();break}},D=t=>{t.addEventListener("timeupdate",M(t)),t.addEventListener("seeking",M(t))};return C.current&&D(C.current),E.current&&D(E.current),(0,s.jsxs)("div",{children:[t&&(0,s.jsx)("div",{className:"sticky top-0 p-4 z-50",children:(0,s.jsx)("audio",{className:"w-full",ref:C,controls:!0,src:t})}),n&&(0,s.jsx)("div",{className:"flex flex-row items-end justify-end fixed bottom-0 end-0 p-4 z-50",children:(0,s.jsx)("video",{className:"h-[30vh] w-auto max-w-full",ref:E,controls:!0,src:n})}),(0,s.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,s.jsx)(l.Y,{className:"hidden",type:"file",ref:W,onChange:t=>{let n=t.target.files[0];if(n.type.startsWith("audio/")){e(URL.createObjectURL(n));return}if(n.type.startsWith("video/")){m(URL.createObjectURL(n));return}}}),!t&&!n&&(0,s.jsx)(r.A,{variant:"solid",color:"primary",onPress:()=>{var t;return null===(t=W.current)||void 0===t?void 0:t.click()},children:"select audio/video"}),(0,s.jsx)(l.Y,{className:"hidden",type:"file",ref:I,onChange:async t=>{let e=t.target.files[0],n=(await e.text()).trim().replaceAll("\r\n","\n").replaceAll("\r","\n"),s=[];for(let t of n.split("\n"))if(!(s.length<1)||"1"===t){if(s.length>0&&t.endsWith("`;"))break;s.push(t)}z(s.join("\n"))}}),(!!t||!!n)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.g,{variant:"solid",color:"primary",isDisabled:!t&&!n,children:(0,s.jsxs)(c.F,{placement:"bottom-end",children:[(0,s.jsx)(o.S,{children:(0,s.jsxs)(r.A,{children:["select subtitle ",(0,s.jsx)(g.QBW,{})]})}),(0,s.jsxs)(d.a,{disallowEmptySelection:!0,className:"max-w-[300px]",selectionMode:"single",onSelectionChange:t=>{var e;"no_translation"===t.currentKey?f(!1):f(!0),null===(e=I.current)||void 0===e||e.click()},children:[(0,s.jsx)(h.W,{description:"This subtitle file does not contain translations.",children:"No Translation"},"no_translation"),(0,s.jsx)(h.W,{description:"This subtitle file contains translations.",children:"With Translation"},"with_translation")]})]})}),(0,s.jsx)(r.A,{variant:"solid",color:"primary",isDisabled:!t&&!n,onPress:()=>b(!_),children:"edit subtitle"})]})]}),y.length>0&&(0,s.jsx)("pre",{className:"my-4",children:y}),_&&(0,s.jsx)(u.Y,{variant:"bordered",value:w,className:"my-4",onChange:t=>z(t.target.value)}),!t&&!n&&(0,s.jsxs)("div",{className:"text-xl",children:[(0,s.jsx)("p",{children:"1, Practice dictation using videos (or audios) and their corresponding subtitles"}),(0,s.jsx)("p",{children:"2, Subtitle files should be in srt format"}),(0,s.jsx)("p",{children:"3, Example: TED"}),(0,s.jsxs)("div",{className:"ms-8 bg-slate-100",children:[(0,s.jsxs)("p",{children:["1, Download video from ",(0,s.jsx)(v,{href:"https://www.ted.com",children:"www.ted.com"}),': click "Share" to download MP4']}),(0,s.jsx)("p",{children:"2, Subtitles are already included in the video. You can extract them using an ffmpeg command:"}),(0,s.jsx)("p",{className:"ps-8",children:'ffprobe exampe.mp4 2>&1 | grep "Subtitle:"'}),(0,s.jsx)("p",{className:"ps-8",children:"find english subtitle, for example: #0:6[0x7](eng), to extract it:"}),(0,s.jsx)("p",{className:"ps-8",children:"ffmpeg -i exampe.mp4 -map 0:6 exampe.srt"})]}),(0,s.jsx)("p",{children:"4, Example: ARD Mediathek"}),(0,s.jsxs)("div",{className:"ms-8 bg-slate-100",children:[(0,s.jsxs)("p",{children:["1, Download video and subtitle using ",(0,s.jsx)(v,{href:"https://mediathekview.de/download/",children:"MediathekView"})]}),(0,s.jsxs)("p",{children:["2, Process and prepare subtitles ",(0,s.jsx)(v,{href:"/listening/subtitle/prepare",children:"here"})]})]}),(0,s.jsx)("p",{children:"5, Example: logo"}),(0,s.jsxs)("div",{className:"ms-8 bg-slate-100",children:[(0,s.jsx)("p",{children:"1, Download video/audio and html file from logo会员群"}),(0,s.jsx)("p",{children:"2, Use html file directly as subtitle file"})]})]}),(!!t||!!n)&&0===A.length&&(0,s.jsxs)("div",{className:"text-xl",children:[(0,s.jsx)("p",{children:"1, 如果是 logo 的用于听写的 html 文件，直接上传即可（选 With Translation）"}),(0,s.jsx)("p",{children:"2, 如果是其他字幕，文件应当是 srt 格式"}),(0,s.jsx)("p",{children:"3, 根据字幕中是否含有译文，点击不同的选项，同时应符合以下要求"}),(0,s.jsx)("p",{className:"ps-8",children:"a, 如果不包含译文，则每条字幕中原文可以有多行"}),(0,s.jsx)("p",{className:"ps-8",children:"b, 如果包含译文，则每条字幕中原文只能占一行，但译文可以有多行"}),(0,s.jsx)("p",{className:"ps-8",children:"c, 如果包含译文，原文在上，译文在下，且只能有一种译文"}),(0,s.jsx)("p",{className:"ps-8",children:"d, 原文和译文都要去掉格式信息，只保留文本"}),(0,s.jsx)("p",{children:"4, 如下字幕格式，包含原文和译文："}),(0,s.jsx)("pre",{className:"ps-8 bg-slate-100",children:"45\n00:02:32,560 --> 00:02:34,240\nWie bitte?\n你说什么？"}),(0,s.jsx)("p",{children:"5, 如下字幕格式，因为原文占用了 2 行，因此不再支持译文："}),(0,s.jsx)("pre",{className:"ps-8 bg-slate-100",children:"45\n00:02:32,560 --> 00:02:34,240\nWie \nbitte?"}),(0,s.jsxs)("p",{children:["6, 如下字幕格式是",(0,s.jsx)("b",{children:"不正确"}),"的，因为原文除了文本，还有字体、颜色等格式信息："]}),(0,s.jsx)("pre",{className:"ps-8 bg-slate-100",children:'45\n00:02:32,560 --> 00:02:34,240\n<font color="#ffffff">Wie bitte?</font>'})]}),(0,s.jsx)("div",{className:"flex flex-col items-center justify-start w-full gap-2 my-8",children:A.map((e,n)=>(0,s.jsx)(j,{item:e,index:n,with_translation:x,media:t?C.current:E.current},n))})]})}},20021:function(t,e,n){"use strict";var s;n.d(e,{H:function(){return s}}),function(t){class e{append(t){this.end_time=t.end_time,this.end_ms=t.end_ms,this.content_list.push(...t.content_list),this.translation_list.push(...t.translation_list)}playMedia(t,e){t.paused||t.pause();let n=e?this.extend_start_ms:this.start_ms,s=e?this.extend_end_ms:this.end_ms;t.currentTime=n/1e3,t.play();let i=setTimeout(()=>{t.removeEventListener("pause",l),t.pause()},s-n);function l(){clearTimeout(i)}t.addEventListener("pause",l)}getTip(){let t=this.content_list.join(" ").replaceAll(/[a-zA-Z0-9äÄöÖüÜßé]/g,"_"),e=0,n="";for(let s of t)"_"===s?e++:e>0&&(n+="".concat(e),e=0),n+=s;return e>0&&(n+="".concat(e)),n}cleanStyle(t){return t.replace(/^<font [^>]*>/,"").replace(/<\/font>$/,"")}content(){return this.content_list.join(" ")}translation(){return this.translation_list.join("\n")}first_line(){return this.content_list?this.content_list[0]:""}last_line(){return this.content_list?this.content_list[this.content_list.length-1]:""}time_str(){return"".concat(this.start_time," --> ").concat(this.end_time)}constructor(t,e){if(this.init_status="error",this.init_error="not initialized",this.position=0,this.start_time="",this.end_time="",this.start_ms=0,this.end_ms=0,this.extend_start_ms=0,this.extend_end_ms=0,this.content_list=[],this.translation_list=[],t.length<2){this.init_status="error",this.init_error="too few lines";return}if(!t[0].match(/^\d+$/)){this.init_status="error",this.init_error="invalid position number: ".concat(t[0]);return}let n=i(t[1]);if(!n){this.init_status="error",this.init_error="invalid time format: ".concat(t[1]);return}this.init_status="success",this.init_error="",this.position=parseInt(t[0]),this.start_time=n.start_time,this.start_ms=n.start_ms,this.end_time=n.end_time,this.end_ms=n.end_ms,e?(t.length>2&&this.content_list.push(this.cleanStyle(t[2])),t.length>3&&t.slice(3).forEach(t=>this.translation_list.push(this.cleanStyle(t)))):t.length>2&&t.slice(2).forEach(t=>this.content_list.push(this.cleanStyle(t)))}}t.Item=e;let n=(t,e,n,s)=>36e5*parseInt(t)+6e4*parseInt(e)+1e3*parseInt(n)+parseInt(s),s=t=>{let e="".concat(Math.floor(t/1e3/60/60)).padStart(2,"0"),n="".concat(Math.floor(t/1e3/60%60)).padStart(2,"0"),s="".concat(Math.floor(t/1e3%60)).padStart(2,"0"),i="".concat(Math.floor(t%1e3)).padStart(2,"0");return"".concat(e,":").concat(n,":").concat(s,",").concat(i)},i=t=>{let e=t.match(/((\d{2}):(\d{2}):(\d{2}),(\d{3})) --> ((\d{2}):(\d{2}):(\d{2}),(\d{3}))/);return e?{start_time:e[1],start_ms:n(e[2],e[3],e[4],e[5]),end_time:e[6],end_ms:n(e[7],e[8],e[9],e[10])}:null},l=(t,e)=>"".concat(s(t)," --> ").concat(s(e)),r=t=>{let e=t.trim().replaceAll("\r\n","\n").replaceAll("\r","\n").split("\n"),n=[],s=[];for(let t of e){if(""===(t=t.trim())){s.length>0&&(n.push(s),s=[]);continue}s.push(t)}return s.length>0&&n.push(s),n},a=t=>{let e=[];for(let n of t){if(e.length>0&&e[e.length-1].last_line().match(/[a-zA-Z0-9äÄöÖüÜßé,:-]$/)&&n.first_line().match(/^[0-9a-z]/)){e[e.length-1].append(n);continue}e.push(n)}for(let t=0;t<e.length;t++)e[t].position=t+1;return e};t.parse_srt_content=(t,n)=>{let s=r(t),i=[],l=s.map(t=>{let s=new e(t,n);return"error"===s.init_status&&i.push(s.init_error),s}).filter(t=>t.content_list.length>0);if(0===i.length){let t=a(a(a(l)));for(let e=0;e<t.length;e++)t[e].position=e+1,t[e].extend_start_ms=e>0?t[e-1].start_ms:t[e].start_ms,t[e].extend_end_ms=e+1<t.length?t[e+1].end_ms:t[e].end_ms;return{status:"success",data:t}}return{status:"error",error:i.join("\n")}},t.build_srt_content=t=>{let e="";return t.forEach(t=>{e+="".concat(t.position,"\n")+"".concat(l(t.start_ms,t.end_ms),"\n"),t.content_list.length>0&&(e+="".concat(t.content(),"\n")),t.translation_list.length>0&&(e+="".concat(t.translation(),"\n")),e+="\n"}),e},t.hideWord=t=>{let e=t.replaceAll(/[a-zA-Z0-9äÄöÖüÜßé]/g,"_"),n=0,s="";for(let t of e)"_"===t?n++:n>0&&(s+="".concat(n),n=0),s+=t;return n>0&&(s+="".concat(n)),s},t.pureContent=t=>t.replaceAll(/[^a-zA-Z0-9äÄöÖüÜßé]/g,""),t.splitContent=(t,e)=>{let n=[],s="";for(let i of t){if(i.match(/[a-zA-Z0-9äÄöÖüÜßé]/)){s+=i;continue}""!==s&&(n.push({isWord:!0,content:s}),s=""),e||n.push({isWord:!1,content:i})}return""!==s&&n.push({isWord:!0,content:s}),n},t.from_breakpoints=t=>{let n=[];for(let s=1;s<t.length;s++){let i=["".concat(s),l(t[s-1],t[s]),"content"];n.push(new e(i,!1))}return n}}(s||(s={}))}},function(t){t.O(0,[614,6051,4122,4459,8627,7669,396,231,5229,162,4471,9601,4088,2971,7023,1744],function(){return t(t.s=42806)}),_N_E=t.O()}]);