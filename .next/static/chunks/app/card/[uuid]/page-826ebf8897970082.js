(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6666],{42480:function(){},55149:function(e,t,a){Promise.resolve().then(a.bind(a,78971))},16463:function(e,t,a){"use strict";var n=a(71169);a.o(n,"useRouter")&&a.d(t,{useRouter:function(){return n.useRouter}}),a.o(n,"useSearchParams")&&a.d(t,{useSearchParams:function(){return n.useSearchParams}})},55195:function(e,t,a){"use strict";a.d(t,{Aj:function(){return m},CZ:function(){return u},LG:function(){return d},fM:function(){return s},ln:function(){return f},lq:function(){return o},mg:function(){return r},pl:function(){return i},tc:function(){return g},yJ:function(){return c},z_:function(){return l}}),a(74590);var n=a(58064),i=(0,n.$)("ae2756021412af3c7533170046625d9bfe173ca7"),s=(0,n.$)("50b8ee2c01702d556b77028eb169eaff9ea0f820"),r=(0,n.$)("92a63b1efc916ff008d1272dc5a65580af78af67");(0,n.$)("40b0e9a5fae5e29abe9213bb007d11cec6f7e31f");var l=(0,n.$)("2c8f731e7c04d6b71f833304321e741fa16aeefd");(0,n.$)("0032af294b820d5b2f6ecb599810073224fb8405");var c=(0,n.$)("479742cc8645e1909d54f38cd9fe015e9621ab60"),o=(0,n.$)("6d2e69b109044da9a0608b4844be959036b9b175");(0,n.$)("b9098ba02eb30e332c60e216b96eda5868da288a");var u=(0,n.$)("651d629a9efc5ac1f2e83ecc837477b8129dac19"),d=(0,n.$)("32a3617889b58b88de5846c96efc11d8a1322d4a"),f=(0,n.$)("59141756fe4b901c2b6407bb9725bab62d2967e1"),g=(0,n.$)("523b5dd287e6725b6f91274aca1051653bfdf0e6"),m=(0,n.$)("fbde93d90dfb682967795128b2ca856ab81d14aa")},78971:function(e,t,a){"use strict";a.d(t,{default:function(){return j}});var n=a(57437),i=a(49354),s=a(79413),r=a(84459),l=a(62753),c=a(38122),o=a(55071),u=a(33788),d=a(8052),f=a(53440),g=a(76993),m=a(69126),b=a(2265),x=a(16463),p=a(39343),h=a(93999),v=a(55195);a(45967);var y=a(44379);function j(e){let{card_ext:t,email:a,edit_view:j,simple:_}=e,w=(0,x.useSearchParams)(),[S,N]=(0,b.useState)(j),[A,U]=(0,b.useState)(),[R,$]=(0,b.useState)([]),[C,z]=(0,b.useState)([]),[P,D]=(0,b.useState)([]),{register:k,handleSubmit:q,formState:I,setValue:E,getValues:M,watch:V}=(0,p.cI)({}),{ref:O,...Q}=k("answer"),F=(0,b.useRef)(null);(0,b.useEffect)(()=>{(async()=>{let e=await (0,v.CZ)(a);if("success"!==e.status)return;$(e.data);let n=t.uuid&&t.user_id===a?t.uuid:(0,i.Fs)();U({uuid:n,user_id:a,question:t.question||"",suggestion:t.suggestion||"",answer:t.answer||"",familiarity:t.familiarity&&t.user_id===a?t.familiarity:0,note:t.note||"",created_at:t.created_at||new Date,updated_at:t.updated_at||new Date});let s=await (0,v.Aj)(a,n);"success"===s.status&&s.data.tag_list_added&&(z(s.data.tag_list_added),D((t.tag_list_suggestion?Array.from(new Set([...s.data.tag_list_added,...t.tag_list_suggestion])):s.data.tag_list_added).filter(t=>e.data.map(e=>e.uuid).includes(t))))})()},[]);let Y=e=>{if(t){let a=(0,i.$s)(t,e);if(a)return a}let a=w.get(e);if(a)return decodeURIComponent(a)},H=e=>y.zQ.map(e=>e.color)[e],K=async(e,t)=>{if(!F.current)return;let a=F.current,n=a.selectionStart,i=a.selectionEnd,s=a.value,r=s.slice(0,n)+e+s.slice(n,i)+t+s.slice(i);a.value=r,F.current.value=r,setTimeout(()=>{a.focus();let s=e.length+t.length;n<i?a.setSelectionRange(n,i+s):a.setSelectionRange(n+s,i+s)},0)},L=async e=>{if(e.familiarity||(e.familiarity=0),"string"==typeof e.familiarity&&(e.familiarity=parseInt(e.familiarity||"0",10)),"success"===(await (0,v.z_)({...A,...e,created_at:(null==A?void 0:A.created_at)?A.created_at:new Date,updated_at:new Date})).status)h.Am.success("save card success");else{h.Am.error("save card failed");return}"success"===(await (0,v.pl)({uuid:A.uuid,tag_list_new:P.filter(e=>!C.includes(e)),tag_list_remove:C.filter(e=>!P.includes(e))})).status?(h.Am.success("save tag successfully"),z(P)):h.Am.error("save tag failed")};return(0,n.jsx)("form",{onSubmit:q(L),children:(0,n.jsxs)("div",{className:"w-full space-y-4 mb-10 px-2",children:[A&&A.user_id!==a&&(0,n.jsx)("div",{className:"flex flex-row my-1 items-start justify-start gap-4",children:(0,n.jsx)(s.O,{className:"text-blue-500 underline",target:"_blank",href:"/card/others?user_id=".concat(A.user_id),children:A.user_id})}),(0,n.jsxs)("div",{className:"flex flex-row my-1 items-end justify-end gap-4",children:[(0,n.jsx)(r.A,{color:"primary",variant:"solid",onPress:()=>N(!S),children:S?"View":"Edit"}),(0,n.jsx)(r.A,{color:"primary",type:"submit",variant:"solid",isLoading:I.isSubmitting,children:"Save"}),(0,n.jsx)(r.A,{color:"danger",variant:"solid",onPress:async()=>{(null==A?void 0:A.uuid)&&("success"==(await (0,v.yJ)(A.uuid)).status?h.Am.error("remove card successfully"):h.Am.error("remove card failed"))},children:"Remove"})]}),S?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.Y,{label:"question",classNames:{input:"text-xl leading-tight font-roboto"},defaultValue:Y("question")||"",...k("question")}),!_&&(0,n.jsx)(c.g,{"aria-label":"select familiarity",selectionMode:"single",defaultSelectedKeys:["".concat(V("familiarity",Y("familiarity")||0))],...k("familiarity"),children:(0,n.jsx)(o.y,{items:y.zQ,children:y.zQ.map(e=>(0,n.jsx)(u.R,{className:"".concat(H(e.value)),children:"".concat(e.value," - ").concat(e.label)},e.value))})}),(0,n.jsx)(d.X,{color:"success",value:P,onValueChange:D,orientation:"horizontal",children:R.map(e=>(0,n.jsx)(f.K,{value:e.uuid,children:e.tag},e.uuid))}),!_&&(0,n.jsx)(l.Y,{label:"suggestion",classNames:{input:"text-xl leading-tight font-roboto"},minRows:1,maxRows:3,defaultValue:Y("suggestion")||"",...k("suggestion")}),(0,n.jsxs)("div",{className:"flex flex-col gap-1 px-3 py-0.5 bg-default-100 hover:bg-default-200 rounded-medium",children:[(0,n.jsx)("label",{className:"text-foreground-500 text-small pb-0.5 pe-2 max-w-full text-ellipsis overflow-hidden",children:"answer"}),(0,n.jsxs)(g.g,{size:"sm",radius:"none",className:"flex flex-row items-center justify-start gap-1",children:[["#","⬌","■","=","≈","➤","\uD83E\uDC46"].map((e,t)=>(0,n.jsx)(r.A,{isIconOnly:!0,className:"text-xl",onPress:()=>K(e,""),children:e},"char1-".concat(t))),["\xe4","\xc4","\xf6","\xd6","\xfc","\xdc","\xdf","€","`````"].map((e,t)=>(0,n.jsx)(r.A,{isIconOnly:!0,className:"text-xl",onPress:()=>K(e,""),children:e},"char2-".concat(t))),["**"].map((e,t)=>(0,n.jsx)(r.A,{isIconOnly:!0,className:"text-xl",onPress:()=>K(e,e),children:e},"char3-".concat(t)))]}),(0,n.jsx)("textarea",{className:"w-full text-xl leading-tight font-roboto px-1.5 outline-none bg-transparent resize-none",defaultValue:Y("answer")||"",rows:10,autoComplete:"off",autoCorrect:"off",spellCheck:"false",...Q,ref:e=>{O(e),F.current=e}})]}),(0,n.jsx)(l.Y,{label:"note",classNames:{input:"text-xl leading-tight font-roboto"},defaultValue:Y("note")||"",...k("note")})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("pre",{className:"text-3xl leading-tight font-roboto font-bold text-wrap",children:V("question",Y("question")||"")}),(0,n.jsx)(m.j,{}),(0,n.jsx)(c.g,{"aria-label":"select familiarity",selectionMode:"single",isDisabled:!0,defaultSelectedKeys:["".concat(V("familiarity",Y("familiarity")||0))],...k("familiarity"),children:(0,n.jsx)(o.y,{items:y.zQ,children:y.zQ.map(e=>(0,n.jsx)(u.R,{className:"".concat(H(e.value)),children:"".concat(e.value," - ").concat(e.label)},e.value))})}),(0,n.jsx)(d.X,{color:"success",value:P,onValueChange:D,orientation:"horizontal",isDisabled:!0,children:R.filter(e=>P.includes(e.uuid)).map(e=>(0,n.jsx)(f.K,{value:e.uuid,children:e.tag},e.uuid))}),(0,n.jsx)(m.j,{}),(0,n.jsx)("div",{className:"text-md font-roboto mx-8",children:V("suggestion",Y("suggestion")||"")}),(0,n.jsx)(m.j,{}),(0,n.jsx)("div",{className:"MD my-1 text-xl leading-tight font-roboto indent-0 whitespace-pre-wrap break-words hyphens-auto",dangerouslySetInnerHTML:{__html:(0,i.Hp)(V("answer",Y("answer"))||"")}}),(0,n.jsx)(m.j,{}),(0,n.jsx)("pre",{className:"text-md font-roboto mx-8",children:V("note",Y("note")||"")})]})]})})}},44379:function(e,t,a){"use strict";var n,i,s,r;a.d(t,{_Y:function(){return l},j8:function(){return c},ll:function(){return o},nr:function(){return u},vA:function(){return n},zQ:function(){return d}}),(s=n||(n={})).Normal="normal",s.Easy="easy",s.Unspecified="unspecified",s.Uncomplete="uncomplete";let l=[{value:"unspecified",description:"all"},{value:"normal",description:"familiarity < 6"},{value:"easy",description:"familiarity = 6"},{value:"uncomplete",description:"question or answer is empty"}],c="unspecified",o="all tagged",u="not tagged";(r=i||(i={}))[r.NewlyAdded=0]="NewlyAdded",r[r.StillUnfamiliar=1]="StillUnfamiliar",r[r.PassiveUnderstanding=2]="PassiveUnderstanding",r[r.RecognitionWithoutUnderstanding=3]="RecognitionWithoutUnderstanding",r[r.UnderstandingInContext=4]="UnderstandingInContext",r[r.ActiveRecall=5]="ActiveRecall",r[r.NaturalUsage=6]="NaturalUsage";let d=[{value:0,description:"Newly Added",label:"newly added",color:"bg-slate-200"},{value:1,description:"Still Unfamiliar",label:"strange",color:"bg-red-200"},{value:2,description:"Passive Understanding",label:"known",color:"bg-orange-200"},{value:3,description:"Recognition Without Understanding",label:"familiar",color:"bg-amber-200"},{value:4,description:"Understanding in Context",label:"skilled",color:"bg-cyan-200"},{value:5,description:"Active Recall",label:"practiced",color:"bg-green-200"},{value:6,description:"Natural Usage",label:"easy & never appear again",color:"bg-lime-200"}]},49354:function(e,t,a){"use strict";a.d(t,{$s:function(){return o},Fs:function(){return c},Hp:function(){return u},p6:function(){return l}}),a(58110);var n=a(11838),i=a.n(n),s=a(12266),r=a(20920);let l=e=>{let t=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0"),i=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),r=e.getSeconds().toString().padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(n," ").concat(i,":").concat(s,":").concat(r)},c=()=>(0,r.Z)().replaceAll("-","");function o(e,t){return e[t]}let u=e=>i().sanitize(s.TU.parse(e,{async:!1,pedantic:!1,gfm:!0}))},45967:function(){}},function(e){e.O(0,[1894,5569,4966,4459,7669,396,6573,9429,5917,5289,6507,9343,2607,2971,7023,1744],function(){return e(e.s=55149)}),_N_E=e.O()}]);